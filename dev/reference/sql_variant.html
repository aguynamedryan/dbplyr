<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="When creating a package that maps to a new SQL based src, you'll often
want to provide some additional mappings from common R commands to the
commands that your tbl provides. These three functions make that
easy."><title>Create an sql translator — sql_substr • dbplyr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.1/font.css" rel="stylesheet"><link href="../deps/_Source%20Code%20Pro-0.4.1/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create an sql translator — sql_substr"><meta property="og:description" content="When creating a package that maps to a new SQL based src, you'll often
want to provide some additional mappings from common R commands to the
commands that your tbl provides. These three functions make that
easy."><meta property="og:image" content="https://dbplyr.tidyverse.org/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="dbplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dbplyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/dbplyr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/backend-2.html">dbplyr 2.0.0 backend API</a>
    <a class="dropdown-item" href="../articles/new-backend.html">Adding a new DBI backend</a>
    <a class="dropdown-item" href="../articles/reprex.html">Reprexes for dbplyr</a>
    <a class="dropdown-item" href="../articles/sql.html">Writing SQL with dbplyr</a>
    <a class="dropdown-item" href="../articles/translation-function.html">Function translation</a>
    <a class="dropdown-item" href="../articles/translation-verb.html">Verb translation</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/06/dbplyr-2-2-0/">Version 2.2.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/02/dplyr-backends/">Version 2.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/11/dbplyr-2-0-0/">Version 2.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/04/dbplyr-1-4-0/">Version 1.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/dbplyr-1-3-0/">Version 1.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/01/dbplyr-1-2/">Version 1.2.0</a>
    <a class="external-link dropdown-item" href="https://blog.rstudio.com/2017/06/27/dbplyr-1-1-0/">Version 1.1.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/dbplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create an sql translator</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dbplyr/blob/HEAD/R/translate-sql-string.R" class="external-link"><code>R/translate-sql-string.R</code></a>, <a href="https://github.com/tidyverse/dbplyr/blob/HEAD/R/translate-sql-paste.R" class="external-link"><code>R/translate-sql-paste.R</code></a>, <a href="https://github.com/tidyverse/dbplyr/blob/HEAD/R/translate-sql-helpers.R" class="external-link"><code>R/translate-sql-helpers.R</code></a>, and 2 more</small>
      <div class="d-none name"><code>sql_variant.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When creating a package that maps to a new SQL based src, you'll often
want to provide some additional mappings from common R commands to the
commands that your tbl provides. These three functions make that
easy.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">sql_substr</span><span class="op">(</span>f <span class="op">=</span> <span class="st">"SUBSTR"</span><span class="op">)</span>

<span class="fu">sql_str_sub</span><span class="op">(</span>subset_f <span class="op">=</span> <span class="st">"SUBSTR"</span>, length_f <span class="op">=</span> <span class="st">"LENGTH"</span>, optional_length <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">sql_paste</span><span class="op">(</span><span class="va">default_sep</span>, f <span class="op">=</span> <span class="st">"CONCAT_WS"</span><span class="op">)</span>

<span class="fu">sql_paste_infix</span><span class="op">(</span><span class="va">default_sep</span>, <span class="va">op</span>, <span class="va">cast</span><span class="op">)</span>

<span class="fu">sql_variant</span><span class="op">(</span>
  scalar <span class="op">=</span> <span class="fu">sql_translator</span><span class="op">(</span><span class="op">)</span>,
  aggregate <span class="op">=</span> <span class="fu">sql_translator</span><span class="op">(</span><span class="op">)</span>,
  window <span class="op">=</span> <span class="fu">sql_translator</span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">sql_translator</span><span class="op">(</span><span class="va">...</span>, .funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, .parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">sql_infix</span><span class="op">(</span><span class="va">f</span>, pad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">sql_prefix</span><span class="op">(</span><span class="va">f</span>, n <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>

<span class="fu">sql_aggregate</span><span class="op">(</span><span class="va">f</span>, f_r <span class="op">=</span> <span class="va">f</span><span class="op">)</span>

<span class="fu">sql_aggregate_2</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>

<span class="fu">sql_aggregate_n</span><span class="op">(</span><span class="va">f</span>, f_r <span class="op">=</span> <span class="va">f</span><span class="op">)</span>

<span class="fu">sql_not_supported</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>

<span class="fu">sql_cast</span><span class="op">(</span><span class="va">type</span><span class="op">)</span>

<span class="fu">sql_try_cast</span><span class="op">(</span><span class="va">type</span><span class="op">)</span>

<span class="fu">sql_log</span><span class="op">(</span><span class="op">)</span>

<span class="fu">sql_cot</span><span class="op">(</span><span class="op">)</span>

<span class="va">base_scalar</span>

<span class="va">base_agg</span>

<span class="va">base_win</span>

<span class="va">base_no_win</span>

<span class="va">base_odbc_scalar</span>

<span class="va">base_odbc_agg</span>

<span class="va">base_odbc_win</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>f</dt>
<dd><p>the name of the sql function as a string</p></dd>
<dt>scalar, aggregate, window</dt>
<dd><p>The three families of functions than an
SQL variant can supply.</p></dd>
<dt>..., .funs</dt>
<dd><p>named functions, used to add custom converters from standard
R functions to sql functions. Specify individually in <code>...</code>, or
provide a list of <code>.funs</code></p></dd>
<dt>.parent</dt>
<dd><p>the sql variant that this variant should inherit from.
Defaults to <code>base_agg</code> which provides a standard set of
mappings for the most common operators and functions.</p></dd>
<dt>pad</dt>
<dd><p>If <code>TRUE</code>, the default, pad the infix operator with spaces.</p></dd>
<dt>n</dt>
<dd><p>for <code>sql_infix()</code>, an optional number of arguments to expect.
Will signal error if not correct.</p></dd>
<dt>f_r</dt>
<dd><p>the name of the r function being translated as a string</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="helper-functions">Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a></h2>
    


<p><code>sql_infix()</code> and <code>sql_prefix()</code> create default SQL infix and prefix
functions given the name of the SQL function. They don't perform any input
checking, but do correctly escape their input, and are useful for
quickly providing default wrappers for a new SQL variant.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="win_over.html">win_over()</a></code> for helper functions for window functions.</p>
<p><code><a href="sql.html">sql()</a></code> for an example of a more customised sql
conversion function.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># An example of adding some mappings for the statistical functions that</span></span>
<span class="r-in"><span class="co"># postgresql provides: http://bit.ly/K5EdTn</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">postgres_agg</span> <span class="op">&lt;-</span> <span class="fu">sql_translator</span><span class="op">(</span>.parent <span class="op">=</span> <span class="va">base_agg</span>,</span>
<span class="r-in">  cor <span class="op">=</span> <span class="fu">sql_aggregate_2</span><span class="op">(</span><span class="st">"CORR"</span><span class="op">)</span>,</span>
<span class="r-in">  cov <span class="op">=</span> <span class="fu">sql_aggregate_2</span><span class="op">(</span><span class="st">"COVAR_SAMP"</span><span class="op">)</span>,</span>
<span class="r-in">  sd <span class="op">=</span>  <span class="fu">sql_aggregate</span><span class="op">(</span><span class="st">"STDDEV_SAMP"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span class="r-in">  var <span class="op">=</span> <span class="fu">sql_aggregate</span><span class="op">(</span><span class="st">"VAR_SAMP"</span>, <span class="st">"var"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Next we have to simulate a connection that uses this variant</span></span>
<span class="r-in"><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_dbi.html">simulate_dbi</a></span><span class="op">(</span><span class="st">"TestCon"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">sql_translation.TestCon</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu">sql_variant</span><span class="op">(</span></span>
<span class="r-in">    <span class="va">base_scalar</span>,</span>
<span class="r-in">    <span class="va">postgres_agg</span>,</span>
<span class="r-in">    <span class="va">base_no_win</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="translate_sql.html">translate_sql</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, con <span class="op">=</span> <span class="va">con</span>, window <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cor(x, y):</span> cor() is not available in this SQL variant</span>
<span class="r-in"><span class="fu"><a href="translate_sql.html">translate_sql</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">income</span> <span class="op">/</span> <span class="va">years</span><span class="op">)</span>, con <span class="op">=</span> <span class="va">con</span>, window <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in sd(income/years):</span> sd() is not available in this SQL variant</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Any functions not explicitly listed in the converter will be translated</span></span>
<span class="r-in"><span class="co"># to sql as is, so you don't need to convert all functions.</span></span>
<span class="r-in"><span class="fu"><a href="translate_sql.html">translate_sql</a></span><span class="op">(</span><span class="fu">regr_intercept</span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span>, con <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SQL&gt; regr_intercept(`y`, `x`)</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, Maximilian Girlich, Edgar Ruiz, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

  </div></footer></body></html>

