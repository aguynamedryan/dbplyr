<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="sql_build() creates a select_query S3 object, that is rendered
to a SQL string by sql_render(). The output from sql_build() is
designed to be easy to test, as it's database agnostic, and has
a hierarchical structure. Outside of testing, however, you should
always call sql_render()."><title>Build and render SQL from a sequence of lazy operations — lazy_join_query • dbplyr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.4/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.4/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Build and render SQL from a sequence of lazy operations — lazy_join_query"><meta property="og:description" content="sql_build() creates a select_query S3 object, that is rendered
to a SQL string by sql_render(). The output from sql_build() is
designed to be easy to test, as it's database agnostic, and has
a hierarchical structure. Outside of testing, however, you should
always call sql_render()."><meta property="og:image" content="https://dbplyr.tidyverse.org/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="dbplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dbplyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.2.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/dbplyr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/backend-2.html">dbplyr 2.0.0 backend API</a>
    <a class="dropdown-item" href="../articles/new-backend.html">Adding a new DBI backend</a>
    <a class="dropdown-item" href="../articles/reprex.html">Reprexes for dbplyr</a>
    <a class="dropdown-item" href="../articles/sql.html">Writing SQL with dbplyr</a>
    <a class="dropdown-item" href="../articles/translation-function.html">Function translation</a>
    <a class="dropdown-item" href="../articles/translation-verb.html">Verb translation</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/06/dbplyr-2-2-0/">Version 2.2.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/02/dplyr-backends/">Version 2.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/11/dbplyr-2-0-0/">Version 2.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/04/dbplyr-1-4-0/">Version 1.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/dbplyr-1-3-0/">Version 1.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/01/dbplyr-1-2/">Version 1.2.0</a>
    <a class="external-link dropdown-item" href="https://blog.rstudio.com/2017/06/27/dbplyr-1-1-0/">Version 1.1.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/dbplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Build and render SQL from a sequence of lazy operations</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dbplyr/blob/HEAD/R/lazy-join-query.R" class="external-link"><code>R/lazy-join-query.R</code></a>, <a href="https://github.com/tidyverse/dbplyr/blob/HEAD/R/lazy-query.R" class="external-link"><code>R/lazy-query.R</code></a>, <a href="https://github.com/tidyverse/dbplyr/blob/HEAD/R/lazy-select-query.R" class="external-link"><code>R/lazy-select-query.R</code></a>, and 6 more</small>
      <div class="d-none name"><code>sql_build.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>sql_build()</code> creates a <code>select_query</code> S3 object, that is rendered
to a SQL string by <code>sql_render()</code>. The output from <code>sql_build()</code> is
designed to be easy to test, as it's database agnostic, and has
a hierarchical structure. Outside of testing, however, you should
always call <code>sql_render()</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lazy_join_query</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">vars</span>,</span>
<span>  <span class="va">type</span>,</span>
<span>  <span class="va">by</span>,</span>
<span>  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".x"</span>, <span class="st">".y"</span><span class="op">)</span>,</span>
<span>  na_matches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"never"</span>, <span class="st">"na"</span><span class="op">)</span>,</span>
<span>  group_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_grps</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  order_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  frame <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lazy_multi_join_query</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">joins</span>,</span>
<span>  <span class="va">table_names</span>,</span>
<span>  <span class="va">vars</span>,</span>
<span>  group_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_grps</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  order_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  frame <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lazy_semi_join_query</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">vars</span>,</span>
<span>  <span class="va">anti</span>,</span>
<span>  <span class="va">by</span>,</span>
<span>  na_matches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"never"</span>, <span class="st">"na"</span><span class="op">)</span>,</span>
<span>  group_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_grps</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  order_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  frame <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lazy_query</span><span class="op">(</span></span>
<span>  <span class="va">query_type</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  group_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_grps</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  order_vars <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  frame <span class="op">=</span> <span class="fu"><a href="lazy_ops.html">op_frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lazy_select_query</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">last_op</span>,</span>
<span>  select <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  where <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group_by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  having <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  order_by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distinct <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  group_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  order_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  frame <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  select_operation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mutate"</span>, <span class="st">"summarise"</span><span class="op">)</span>,</span>
<span>  message_summarise <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lazy_set_op_query</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">type</span>, <span class="va">all</span>, call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">join_query</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">vars</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"inner"</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".x"</span>, <span class="st">".y"</span><span class="op">)</span>,</span>
<span>  na_matches <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">select_query</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  select <span class="op">=</span> <span class="fu"><a href="sql.html">sql</a></span><span class="op">(</span><span class="st">"*"</span><span class="op">)</span>,</span>
<span>  where <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  group_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  having <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  order_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distinct <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">semi_join_query</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">vars</span>, anti <span class="op">=</span> <span class="cn">FALSE</span>, by <span class="op">=</span> <span class="cn">NULL</span>, na_matches <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">set_op_query</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">type</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sql_build</span><span class="op">(</span><span class="va">op</span>, con <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sql_render</span><span class="op">(</span><span class="va">query</span>, con <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>, subquery <span class="op">=</span> <span class="cn">FALSE</span>, lvl <span class="op">=</span> <span class="fl">0</span>, cte <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sql_optimise</span><span class="op">(</span><span class="va">x</span>, con <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>, subquery <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>...</dt>
<dd><p>Other arguments passed on to the methods. Not currently used.</p></dd>


<dt>op</dt>
<dd><p>A sequence of lazy operations</p></dd>


<dt>con</dt>
<dd><p>A database connection. The default <code>NULL</code> uses a set of
rules that should be very similar to ANSI 92, and allows for testing
without an active database connection.</p></dd>


<dt>subquery</dt>
<dd><p>Is this SQL going to be used in a subquery?
This is important because you can place a bare table name in a subquery
and  ORDER BY does not work in subqueries.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>sql_build()</code> is generic over the lazy operations, <a href="lazy_ops.html">lazy_ops</a>,
and generates an S3 object that represents the query. <code>sql_render()</code>
takes a query object and then calls a function that is generic
over the database. For example, <code>sql_build.op_mutate()</code> generates
a <code>select_query</code>, and <code>sql_render.select_query()</code> calls
<code><a href="https://dplyr.tidyverse.org/reference/backend_dbplyr.html" class="external-link">sql_select()</a></code>, which has different methods for different databases.
The default methods should generate ANSI 92 SQL where possible, so you
backends only need to override the methods if the backend is not ANSI
compliant.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, Maximilian Girlich, Edgar Ruiz, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

